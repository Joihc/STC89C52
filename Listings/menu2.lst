C51 COMPILER V9.57.0.0   MENU2                                                             06/07/2018 09:40:57 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MENU2
OBJECT MODULE PLACED IN .\Objects\menu2.obj
COMPILER INVOKED BY: D:\pro\keil5\core\C51\BIN\C51.EXE source\menu2.c LARGE OPTIMIZE(9,SPEED) BROWSE INCDIR(.\include) D
                    -EBUG OBJECTEXTEND PRINT(.\Listings\menu2.lst) TABS(2) OBJECT(.\Objects\menu2.obj)

line level    source

   1          #define MENU2_C_
   2          #include "menu2.h"
   3          
   4          
   5          #define MENU2_INDEX 14
   6          #define MENU2_NUM 12
   7          uint8  code set_str[MENU2_INDEX][MENU2_NUM] = {
   8            {"  输入密码  "},
   9            {"  最大功率  "},
  10            {"最大供电电压"},
  11            {"最小供电电压"},
  12            {"最大线盘电流"},
  13            {"最大线盘温度"},
  14            {"通用线盘温度"},
  15            {"最大锅内温度"},   
  16            {"最大漏料温度"}, 
  17            {"最大IGBT频率"},
  18            {"最小IGBT频率"},
  19            {"最大IGBT温度"},
  20            {"限制工作时间"},
  21            {"恢复出厂设置"},
  22          };
  23          
  24          static int16 set_value[MENU2_INDEX]={
  25            0,
  26            0,
  27            0,
  28            0,
  29            0,
  30            0,
  31            0,
  32            0,
  33            0,
  34            0,
  35            0,
  36            0,
  37            0,
  38            0,
  39          };
  40          
  41          bit menu2_value_update = 0;
  42          
  43          int8 menu2_now_page = 0;
  44          int8 menu2_old_page = -1;
  45          bit menu2_display =0;
  46          
  47          bit menu2_set =0;//在设置状态
  48          uint8 menu2_set_num = 0;//默认设置0位  左到右 0 1 2 3 4
  49          
  50          static int16 menu2_value =0;
  51          static uint8 menu2_str[16]={""};
  52          
  53          static uint32 heart_beat_men2 =0;
  54          
C51 COMPILER V9.57.0.0   MENU2                                                             06/07/2018 09:40:57 PAGE 2   

  55          //显示菜单2界面
  56          void Discrable_Menu2_String(uint8 per)
  57          {
  58   1        uint8 mark;
  59   1        int16 value = set_value[per];
  60   1        for(mark=0;mark<16;mark++)
  61   1        {
  62   2          menu2_str[mark]=' ';
  63   2        }
  64   1        for(mark=2;mark<14;mark++)
  65   1        {
  66   2          menu2_str[mark]=set_str[per][mark-2];
  67   2        }
  68   1        Display_String(1,menu2_str);//菜单头
  69   1        
  70   1        for(mark=0;mark<16;mark++)
  71   1        {
  72   2          menu2_str[mark]=' ';
  73   2        }
  74   1        if(value <0)
  75   1        {
  76   2          value = 0;
  77   2        }
  78   1        //mark = (value<0?1:0);
  79   1        value = abs(value);
  80   1        
  81   1      //  menu2_str[0]='<';
  82   1      //  menu2_str[1]='<';
  83   1      //  menu2_str[2]='<';
  84   1      //  menu2_str[3]='<';
  85   1      //  menu2_str[4]='<';
  86   1        menu2_str[5] = value%100000/10000+0x30; 
  87   1        menu2_str[6] = value%10000/1000+0x30;
  88   1        menu2_str[7] = value%1000/100+0x30;
  89   1        menu2_str[8] = value%100/10+0x30;
  90   1        menu2_str[9]  ='.'; 
  91   1        menu2_str[10] =value%10+0x30;
  92   1      //  menu2_str[11]='>';
  93   1      //  menu2_str[12]='>';
  94   1      //  menu2_str[13]='>';
  95   1      //  menu2_str[14]='>';
  96   1      //  menu2_str[15]='>';
  97   1        Display_String(3,menu2_str);//菜单值
  98   1      }
  99          void Set_Mark()
 100          {
 101   1        uint8 mark;
 102   1        for(mark=0;mark<16;mark++)
 103   1          {
 104   2            menu2_str[mark]=' ';
 105   2          }
 106   1          if(menu2_set)
 107   1          {
 108   2            switch(menu2_set_num)
 109   2            {
 110   3              case 0:
 111   3                menu2_str[10]=0x18;
 112   3                break;
 113   3              case 1:
 114   3                menu2_str[8]=0x18;
 115   3                break;
 116   3              case 2:
C51 COMPILER V9.57.0.0   MENU2                                                             06/07/2018 09:40:57 PAGE 3   

 117   3                menu2_str[7]=0x18;
 118   3                break;
 119   3              case 3:
 120   3                menu2_str[6]=0x18;
 121   3                break;
 122   3              case 4:
 123   3                menu2_str[5]=0x18;
 124   3                break;
 125   3            }
 126   2          }
 127   1          Display_String(2,menu2_str);//菜单值
 128   1          for(mark=0;mark<16;mark++)
 129   1          {
 130   2            menu2_str[mark]=' ';
 131   2          }
 132   1          if(menu2_set)
 133   1          {
 134   2            switch(menu2_set_num)
 135   2            {
 136   3              case 0:
 137   3                menu2_str[10]=0x19;
 138   3                break;
 139   3              case 1:
 140   3                menu2_str[8]=0x19;
 141   3                break;
 142   3              case 2:
 143   3                menu2_str[7]=0x19;
 144   3                break;
 145   3              case 3:
 146   3                menu2_str[6]=0x19;
 147   3                break;
 148   3              case 4:
 149   3                menu2_str[5]=0x19;
 150   3                break;
 151   3            }
 152   2          }
 153   1          Display_String(4,menu2_str);//菜单值
 154   1      }
 155          
 156          //返回多少页 0 1 2 3
 157          void Display_Menu2_Screen()
 158          {
 159   1        while(1)
 160   1        {
 161   2          if(Down_Key_Down())
 162   2          {
 163   3            if(menu2_old_page < MENU2_INDEX-1 && !menu2_set)
 164   3            {
 165   4              menu2_now_page++;
 166   4            }
 167   3            else if(menu2_set)
 168   3            {
 169   4              if(set_value[menu2_old_page]-My_Pow(10,menu2_set_num)<0)
 170   4              {
 171   5                menu2_value =0;
 172   5              }
 173   4              else
 174   4              {
 175   5                menu2_value = set_value[menu2_old_page]-My_Pow(10,menu2_set_num);
 176   5              }
 177   4              Set_Menu2_Value(menu2_old_page,menu2_value);
 178   4              //Send_To_Client_Packet(40+menu2_old_page,menu2_value);
C51 COMPILER V9.57.0.0   MENU2                                                             06/07/2018 09:40:57 PAGE 4   

 179   4              
 180   4            }   
 181   3          }
 182   2          else if(Up_Key_Down())
 183   2          {
 184   3            if(menu2_old_page >0 && !menu2_set)
 185   3            {
 186   4              menu2_now_page--;
 187   4            }
 188   3            else if(menu2_set)
 189   3            {
 190   4              if(set_value[menu2_old_page] + My_Pow(10,menu2_set_num) > 32767)
 191   4              {
 192   5                menu2_value = 32767;
 193   5              }
 194   4              else
 195   4              {
 196   5                menu2_value = set_value[menu2_old_page] + My_Pow(10,menu2_set_num);
 197   5              }
 198   4              Set_Menu2_Value(menu2_old_page,menu2_value);
 199   4            }
 200   3          }
 201   2          else if(Return_Key_Down())
 202   2          {
 203   3            break;
 204   3          }   
 205   2          else if(Ok_Key_Down())
 206   2          {
 207   3            //send_PC('A');
 208   3            menu2_set= ~menu2_set;
 209   3            menu2_set_num =4;//切换一次就把设置位归零
 210   3            if(!menu2_set)
 211   3            {
 212   4              //保存
 213   4              Send_To_Client_Packet(50+menu2_old_page,menu2_value);
 214   4            }
 215   3          }
 216   2          else if(Left_Key_Down() && menu2_set && menu2_set_num <4)
 217   2          {
 218   3            menu2_set_num++;
 219   3          }
 220   2          else if(Right_Key_Down() && menu2_set && menu2_set_num >0)
 221   2          {
 222   3            menu2_set_num--;
 223   3          }
 224   2          Set_Mark();
 225   2          
 226   2          Usart_Update();   
 227   2          if(menu2_now_page == menu2_old_page && menu2_display==1)
 228   2          {
 229   3            //只更新数据
 230   3            if(menu2_value_update)
 231   3            {
 232   4              menu2_value_update =0;
 233   4              Update_Menu2_Value();
 234   4            }
 235   3            continue;
 236   3          }
 237   2          menu2_display = 1;
 238   2          
 239   2          menu2_old_page = menu2_now_page;
 240   2          
C51 COMPILER V9.57.0.0   MENU2                                                             06/07/2018 09:40:57 PAGE 5   

 241   2          Wr_Command(0x01,1); //显示清屏
 242   2      
 243   2          Discrable_Menu2_String(menu2_old_page); 
 244   2      
 245   2      
 246   2        }
 247   1        menu2_display = 0;
 248   1        menu2_set=0;//退出更改模式到显示模式
 249   1      }
 250          
 251          void Update_Menu2_Value()
 252          {
 253   1        uint8 i =0;
 254   1        for(i=0;i<16;i++)
 255   1        {
 256   2          menu2_str[i]=' ';
 257   2        } 
 258   1        menu2_str[5] = set_value[menu2_old_page]%100000/10000+0x30; 
 259   1        menu2_str[6] = set_value[menu2_old_page]%10000/1000+0x30;
 260   1        menu2_str[7] = set_value[menu2_old_page]%1000/100+0x30;
 261   1        menu2_str[8] = set_value[menu2_old_page]%100/10+0x30;
 262   1        menu2_str[9]  ='.'; 
 263   1        menu2_str[10] =set_value[menu2_old_page]%10+0x30;
 264   1        Display_String(3,menu2_str);//菜单值
 265   1      }
 266          void Set_Menu2_Value(int8 index,int16 value)
 267          {
 268   1        //index-=40;
 269   1        if(set_value[index] != value)
 270   1        {
 271   2          set_value[index] = value;
 272   2          menu2_value_update = 1;
 273   2        }
 274   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    978    ----
   CONSTANT SIZE    =    168    ----
   XDATA SIZE       =     53       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
